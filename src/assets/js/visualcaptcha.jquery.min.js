/*
 almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/almond for details
 visualCaptcha - v0.0.8 - 2016-01-23
 http://visualcaptcha.net
 Copyright (c) 2016 emotionLoop; Licensed MIT */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,k,n){d instanceof String&&(d=String(d));for(var g=d.length,b=0;b<g;b++){var a=d[b];if(k.call(n,a,b,d))return{i:b,v:a}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,k,n){d!=Array.prototype&&d!=Object.prototype&&(d[k]=n.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,k,n,g){if(k){n=$jscomp.global;d=d.split(".");for(g=0;g<d.length-1;g++){var b=d[g];b in n||(n[b]={});n=n[b]}d=d[d.length-1];g=n[d];k=k(g);k!=g&&null!=k&&$jscomp.defineProperty(n,d,{configurable:!0,writable:!0,value:k})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,n){return $jscomp.findInternal(this,d,n).v}},"es6","es3");
(function(d,k){"function"===typeof define&&define.amd?define(["jquery"],k):k(d.jQuery)})(this,function(d){var k,n,g;(function(b){function a(e,a){var f,b,p=a&&a.split("/"),c=l.map,m=c&&c["*"]||{};if(e&&"."===e.charAt(0))if(a){p=p.slice(0,p.length-1);e=e.split("/");a=e.length-1;l.nodeIdCompat&&y.test(e[a])&&(e[a]=e[a].replace(y,""));e=p.concat(e);for(a=0;a<e.length;a+=1){var h=e[a];if("."===h)e.splice(a,1),--a;else if(".."===h)if(1!==a||".."!==e[2]&&".."!==e[0])0<a&&(e.splice(a-1,2),a-=2);else break}e=
e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||m)&&c){h=e.split("/");for(a=h.length;0<a;--a){var d=h.slice(0,a).join("/");if(p)for(b=p.length;0<b;--b)if(f=c[p.slice(0,b).join("/")])if(f=f[d]){var q=f;var r=a;break}if(q)break;if(!t&&m&&m[d]){var t=m[d];var g=a}}!q&&t&&(q=t,r=g);q&&(h.splice(0,r,q),e=h.join("/"))}return e}function h(e,a){return function(){return f.apply(b,B.call(arguments,0).concat([e,a]))}}function c(e){return function(f){return a(f,e)}}function d(e){return function(a){m[e]=
a}}function w(a){if(q.call(r,a)){var e=r[a];delete r[a];t[a]=!0;x.apply(b,e)}if(!q.call(m,a)&&!q.call(t,a))throw Error("No "+a);return m[a]}function z(a){var e=a?a.indexOf("!"):-1;if(-1<e){var f=a.substring(0,e);a=a.substring(e+1,a.length)}return[f,a]}function C(a){return function(){return l&&l.config&&l.config[a]||{}}}var f,m={},r={},l={},t={},q=Object.prototype.hasOwnProperty,B=[].slice,y=/\.js$/;var A=function(e,f){e=z(e);var b=e[0];e=e[1];if(b){b=a(b,f);var l=w(b)}b?e=l&&l.normalize?l.normalize(e,
c(f)):a(e,f):(e=a(e,f),e=z(e),b=e[0],e=e[1],b&&(l=w(b)));return{f:b?b+"!"+e:e,n:e,pr:b,p:l}};var u={require:function(a){return h(a)},exports:function(a){var e=m[a];return"undefined"!==typeof e?e:m[a]={}},module:function(a){return{id:a,uri:"",exports:m[a],config:C(a)}}};var x=function(a,f,l,c){var e,p=[];var g=typeof l;c=c||a;if("undefined"===g||"function"===g){f=!f.length&&l.length?["require","exports","module"]:f;for(e=0;e<f.length;e+=1){var k=A(f[e],c);g=k.f;if("require"===g)p[e]=u.require(a);else if("exports"===
g){p[e]=u.exports(a);var n=!0}else if("module"===g)var v=p[e]=u.module(a);else if(q.call(m,g)||q.call(r,g)||q.call(t,g))p[e]=w(g);else if(k.p)k.p.load(k.n,h(c,!0),d(g),{}),p[e]=m[g];else throw Error(a+" missing "+g);}f=l?l.apply(m[a],p):void 0;a&&(v&&v.exports!==b&&v.exports!==m[a]?m[a]=v.exports:f===b&&n||(m[a]=f))}else a&&(m[a]=l)};k=n=f=function(a,c,h,m,d){if("string"===typeof a)return u[a]?u[a](c):w(A(a,c).f);if(!a.splice){l=a;l.deps&&f(l.deps,l.callback);if(!c)return;c.splice?(a=c,c=h,h=null):
a=b}c=c||function(){};"function"===typeof h&&(h=m,m=d);m?x(b,a,c,h):setTimeout(function(){x(b,a,c,h)},4);return f};f.config=function(a){return f(a)};k._defined=m;g=function(a,f,b){f.splice||(b=f,f=[]);q.call(m,a)||q.call(r,a)||(r[a]=[a,f,b])};g.amd={jQuery:!0}})();g("almond",function(){});g("visualcaptcha/core",[],function(){var b=function(a,b,c){c=c||[];a.namespace&&0<a.namespace.length&&c.push(a.namespaceFieldName+"="+a.namespace);c.push(a.randomParam+"="+a.randomNonce);return b+"?"+c.join("&")};
var a=function(a){var b=this;a.applyRandomNonce();a.isLoading=!0;var f=h(a);a._loading(b);a.callbacks.loading&&a.callbacks.loading(b);a.request(f,function(f){f.audioFieldName&&(a.audioFieldName=f.audioFieldName);f.imageFieldName&&(a.imageFieldName=f.imageFieldName);f.imageName&&(a.imageName=f.imageName);f.values&&(a.imageValues=f.values);a.isLoading=!1;a.hasLoaded=!0;a._loaded(b);a.callbacks.loaded&&a.callbacks.loaded(b)})};var h=function(a){return b(a,a.url+a.routes.start+"/"+a.numberOfImages)};
var c=function(a,c){var f="",l=[];if(0>c||c>=a.numberOfImages)return f;this.isRetina()&&l.push("retina=1");f=a.url+a.routes.image+"/"+c;return b(a,f,l)};var d=function(a,c){var f=a.url+a.routes.audio;c&&(f+="/ogg");return b(a,f)};var g=function(a,b){return 0<=b&&b<a.numberOfImages?a.imageValues[b]:""};var k=function(){return void 0!==window.devicePixelRatio&&1<window.devicePixelRatio};var n=function(){var a=!1;try{var b=document.createElement("audio");b.canPlayType&&(a=!0)}catch(r){}return a};return function(b){var f=
{refresh:function(){return a.call(this,b)},isLoading:function(){return b.isLoading},hasLoaded:function(){return b.hasLoaded},numberOfImages:function(){return b.imageValues.length},imageName:function(){return b.imageName},imageValue:function(a){return g.call(this,b,a)},imageUrl:function(a){return c.call(this,b,a)},audioUrl:function(a){return d.call(this,b,a)},imageFieldName:function(){return b.imageFieldName},audioFieldName:function(){return b.audioFieldName},namespace:function(){return b.namespace},
namespaceFieldName:function(){return b.namespaceFieldName},isRetina:k,supportsAudio:n};b.autoRefresh&&f.refresh();return f}});g("visualcaptcha/xhr-request",[],function(){var b=window.XMLHttpRequest;return function(a,h){var c=new b;c.open("GET",a,!0);c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var a=JSON.parse(c.responseText);h(a)}};c.send()}});g("visualcaptcha/config",["visualcaptcha/xhr-request"],function(b){return function(a){var h=window.location.href.split("/");h[h.length-
1]="";var c={request:b,url:h.join("/").slice(0,-1),namespace:"",namespaceFieldName:"namespace",routes:{start:"/start",image:"/image",audio:"/audio"},isLoading:!1,hasLoaded:!1,autoRefresh:!0,numberOfImages:6,randomNonce:"",randomParam:"r",audioFieldName:"",imageFieldName:"",imageName:"",imageValues:[],callbacks:{},_loading:function(){},_loaded:function(){},applyRandomNonce:function(){return c.randomNonce=Math.random().toString(36).substring(2)}};a.request&&(c.request=a.request);a.url&&(c.url=a.url);
a.namespace&&(c.namespace=a.namespace);a.namespaceFieldName&&(c.namespaceFieldName=a.namespaceFieldName);"undefined"!==typeof a.autoRefresh&&(c.autoRefresh=a.autoRefresh);a.numberOfImages&&(c.numberOfImages=a.numberOfImages);a.routes&&(a.routes.start&&(c.routes.start=a.routes.start),a.routes.image&&(c.routes.image=a.routes.image),a.routes.audio&&(c.routes.audio=a.routes.audio));a.randomParam&&(c.randomParam=a.randomParam);a.callbacks&&(a.callbacks.loading&&(c.callbacks.loading=a.callbacks.loading),
a.callbacks.loaded&&(c.callbacks.loaded=a.callbacks.loaded));a._loading&&(c._loading=a._loading);a._loaded&&(c._loaded=a._loaded);return c}});g("visualcaptcha",["require","visualcaptcha/core","visualcaptcha/config"],function(b){var a=b("visualcaptcha/core"),h=b("visualcaptcha/config");return function(b){b=b||{};return a(h(b))}});g("visualcaptcha/templates",[],function(){var b=function(a,b){for(var c in b)a=a.replace(new RegExp("{"+c+"}","g"),b[c]);return a};return{buttons:function(a,h,c,d){var g=
b(d.button,{class:"accessibility",classTitle:"{accessibilityTitle}",classAlt:"{accessibilityAlt}"});var k=b(d.button,{class:"refresh",classTitle:"{refreshTitle}",classAlt:"{refreshAlt}"});d=b(d.buttonGroup,{btnRefresh:k,btnAccessibility:a.supportsAudio()?g:""});a={path:c||"",refreshTitle:h.refreshTitle,refreshAlt:h.refreshAlt,accessibilityTitle:h.accessibilityTitle,accessibilityAlt:h.accessibilityAlt,retinaExtra:a.isRetina()?"@2x":""};return b(d,a)},accessibility:function(a,d){if(!a.supportsAudio())return"";
a={accessibilityDescription:d.accessibilityDescription,audioURL:a.audioUrl(),audioFieldName:a.audioFieldName()};return b('<div class="visualCaptcha-accessibility-wrapper visualCaptcha-hide"><div class="accessibility-description">{accessibilityDescription}</div><audio preload="preload"><source src="{audioURL}" type="audio/ogg" /><source src="{audioURL}" type="audio/mpeg" /></audio></div>',a)},images:function(a,d){for(var c="",h,g,k=0,n=a.numberOfImages();k<n;k++)h='<div class="img"><a href="javascript:;"><img src="{imageUrl}" id="visualCaptcha-img-{i}" data-index="{i}" alt="" title="" /></a></div>',
g={imageUrl:a.imageUrl(k),i:k},c+=b(h,g);h='<p class="visualCaptcha-explanation">{explanation}</p><div class="visualCaptcha-possibilities">{images}</div>';g={imageFieldName:a.imageFieldName(),explanation:d.explanation.replace(/ANSWER/,a.imageName()),images:c};return b(h,g)},audioInput:function(a){a={audioFieldName:a.audioFieldName()};return b('<input class="form-control audioField" type="text" name="{audioFieldName}" value="" autocomplete="off" />',a)},imageInput:function(a,d){a={imageFieldName:a.imageFieldName(),
value:a.imageValue(d)};return b('<input class="form-control imageField" type="hidden" name="{imageFieldName}" value="{value}" readonly="readonly" />',a)},namespaceInput:function(a){var d=a.namespace();if(!d||0===d.length)return"";a={fieldName:a.namespaceFieldName(),value:d};return b('<input type="hidden" name="{fieldName}" value="{value}" />',a)}}});g("visualcaptcha/language",[],function(){return{accessibilityAlt:"Sound icon",accessibilityTitle:"Accessibility option: listen to a question and answer it!",
accessibilityDescription:"Type below the <strong>answer</strong> to what you hear. Numbers or words:",explanation:"Click or touch the <strong>ANSWER</strong>",refreshAlt:"Refresh/reload icon",refreshTitle:"Refresh/reload: get new images and accessibility option!"}});g("visualcaptcha.jquery",["jquery","visualcaptcha","visualcaptcha/templates","visualcaptcha/language"],function(b,a,d,c){var g=function(a,c){b.get(a,c,"json")};var h=function(){};var k=function(a,b,c){a=d.namespaceInput(c)+d.accessibility(c,
a.language)+d.images(c,a.language)+d.buttons(c,a.language,a.imgPath);b.html(a)};var n=function(){var a=b(this).closest(".visualCaptcha"),c=a.find(".visualCaptcha-accessibility-wrapper"),f=a.find(".visualCaptcha-possibilities"),g=a.find(".visualCaptcha-explanation"),h=c.find("audio");c.hasClass("visualCaptcha-hide")?(f.toggleClass("visualCaptcha-hide"),g.toggleClass("visualCaptcha-hide"),f.find(".img").removeClass("visualCaptcha-selected"),g.find("input").val(""),a=d.audioInput(a.data("captcha")),
b(a).insertBefore(h),c.toggleClass("visualCaptcha-hide"),h[0].load(),h[0].play()):(h[0].pause(),c.toggleClass("visualCaptcha-hide"),c.find("input").remove(),g.toggleClass("visualCaptcha-hide"),f.toggleClass("visualCaptcha-hide"))};var f=function(){var a=b(this),c=a.closest(".visualCaptcha"),f=c.find(".visualCaptcha-possibilities"),g=c.find(".visualCaptcha-explanation"),h;if(h=g.find("input"))h.remove(),f.find(".img").removeClass("visualCaptcha-selected");a.addClass("visualCaptcha-selected");a=a.find("img").data("index");
c=d.imageInput(c.data("captcha"),a);g.append(b(c))};var m=function(){b(this).closest(".visualCaptcha").data("captcha").refresh()};var r=function(a){var b=a.find(".imageField");a=a.find(".audioField");var c=!(!b.val()&&!a.val());return c?{valid:c,name:b.val()?b.attr("name"):a.attr("name"),value:b.val()?b.val():a.val()}:{valid:c}};b.fn.visualCaptcha=function(d){var l=b.extend({imgPath:"/",language:c,captcha:{request:g},templates:{button:'<div class="visualCaptcha-{class}-button"><a href="javascript:;"><img src="{path}{class}{retinaExtra}.png" title="{classTitle}" alt="{classAlt}"></a></div>',
buttonGroup:'<div class="visualCaptcha-button-group">{btnRefresh}{btnAccessibility}</div>'}},d);this.addClass("visualCaptcha").on("click",".visualCaptcha-accessibility-button",n).on("click",".visualCaptcha-refresh-button",m).on("click",".visualCaptcha-possibilities .img",f);return this.each(function(){var c=b(this);var d=b.extend(l.captcha,{_loading:h.bind(null,l,c),_loaded:k.bind(null,l,c)});"undefined"!==typeof c.data("namespace")&&(d.namespace=c.data("namespace"));d=a(d);d.getCaptchaData=r.bind(null,
c);c.data("captcha",d)})}});g("jquery",function(){return d});n("visualcaptcha.jquery")});
