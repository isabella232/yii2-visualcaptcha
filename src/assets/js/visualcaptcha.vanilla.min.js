/*
 almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/almond for details
 visualCaptcha - v0.0.8 - 2016-01-23
 http://visualcaptcha.net
 Copyright (c) 2016 emotionLoop; Licensed MIT */
(function(x,v){"function"===typeof define&&define.amd?define([],v):x.visualCaptcha=v()})(this,function(){var x,v,l;(function(d){function a(f,a){var b,e,c=a&&a.split("/"),p=g.map,k=p&&p["*"]||{};if(f&&"."===f.charAt(0))if(a){c=c.slice(0,c.length-1);f=f.split("/");a=f.length-1;g.nodeIdCompat&&A.test(f[a])&&(f[a]=f[a].replace(A,""));f=c.concat(f);for(a=0;a<f.length;a+=1){var m=f[a];if("."===m)f.splice(a,1),--a;else if(".."===m)if(1!==a||".."!==f[2]&&".."!==f[0])0<a&&(f.splice(a-1,2),a-=2);else break}f=
f.join("/")}else 0===f.indexOf("./")&&(f=f.substring(2));if((c||k)&&p){m=f.split("/");for(a=m.length;0<a;--a){var n=m.slice(0,a).join("/");if(c)for(e=c.length;0<e;--e)if(b=p[c.slice(0,e).join("/")])if(b=b[n]){var d=b;var h=a;break}if(d)break;if(!t&&k&&k[n]){var t=k[n];var r=a}}!d&&t&&(d=t,h=r);d&&(m.splice(0,h,d),f=m.join("/"))}return f}function b(a,b){return function(){return e.apply(d,y.call(arguments,0).concat([a,b]))}}function c(f){return function(b){return a(b,f)}}function q(a){return function(f){n[a]=
f}}function k(a){if(p.call(r,a)){var f=r[a];delete r[a];t[a]=!0;z.apply(d,f)}if(!p.call(n,a)&&!p.call(t,a))throw Error("No "+a);return n[a]}function h(a){var f=a?a.indexOf("!"):-1;if(-1<f){var b=a.substring(0,f);a=a.substring(f+1,a.length)}return[b,a]}function u(a){return function(){return g&&g.config&&g.config[a]||{}}}var e,n={},r={},g={},t={},p=Object.prototype.hasOwnProperty,y=[].slice,A=/\.js$/;var B=function(f,b){f=h(f);var e=f[0];f=f[1];if(e){e=a(e,b);var g=k(e)}e?f=g&&g.normalize?g.normalize(f,
c(b)):a(f,b):(f=a(f,b),f=h(f),e=f[0],f=f[1],e&&(g=k(e)));return{f:e?e+"!"+f:f,n:f,pr:e,p:g}};var w={require:function(a){return b(a)},exports:function(a){var b=n[a];return"undefined"!==typeof b?b:n[a]={}},module:function(a){return{id:a,uri:"",exports:n[a],config:u(a)}}};var z=function(a,e,g,c){var f,h=[];var m=typeof g;c=c||a;if("undefined"===m||"function"===m){e=!e.length&&g.length?["require","exports","module"]:e;for(f=0;f<e.length;f+=1){var u=B(e[f],c);m=u.f;if("require"===m)h[f]=w.require(a);else if("exports"===
m){h[f]=w.exports(a);var y=!0}else if("module"===m)var l=h[f]=w.module(a);else if(p.call(n,m)||p.call(r,m)||p.call(t,m))h[f]=k(m);else if(u.p)u.p.load(u.n,b(c,!0),q(m),{}),h[f]=n[m];else throw Error(a+" missing "+m);}e=g?g.apply(n[a],h):void 0;a&&(l&&l.exports!==d&&l.exports!==n[a]?n[a]=l.exports:e===d&&y||(n[a]=e))}else a&&(n[a]=g)};x=v=e=function(a,b,c,p,h){if("string"===typeof a)return w[a]?w[a](b):k(B(a,b).f);if(!a.splice){g=a;g.deps&&e(g.deps,g.callback);if(!b)return;b.splice?(a=b,b=c,c=null):
a=d}b=b||function(){};"function"===typeof c&&(c=p,p=h);p?z(d,a,b,c):setTimeout(function(){z(d,a,b,c)},4);return e};e.config=function(a){return e(a)};x._defined=n;l=function(a,b,e){b.splice||(e=b,b=[]);p.call(n,a)||p.call(r,a)||(r[a]=[a,b,e])};l.amd={jQuery:!0}})();l("almond",function(){});l("visualcaptcha/core",[],function(){var d=function(a,b,c){c=c||[];a.namespace&&0<a.namespace.length&&c.push(a.namespaceFieldName+"="+a.namespace);c.push(a.randomParam+"="+a.randomNonce);return b+"?"+c.join("&")};
var a=function(a){var c=this;a.applyRandomNonce();a.isLoading=!0;var e=b(a);a._loading(c);a.callbacks.loading&&a.callbacks.loading(c);a.request(e,function(b){b.audioFieldName&&(a.audioFieldName=b.audioFieldName);b.imageFieldName&&(a.imageFieldName=b.imageFieldName);b.imageName&&(a.imageName=b.imageName);b.values&&(a.imageValues=b.values);a.isLoading=!1;a.hasLoaded=!0;a._loaded(c);a.callbacks.loaded&&a.callbacks.loaded(c)})};var b=function(a){return d(a,a.url+a.routes.start+"/"+a.numberOfImages)};
var c=function(a,b){var c="",g=[];if(0>b||b>=a.numberOfImages)return c;this.isRetina()&&g.push("retina=1");c=a.url+a.routes.image+"/"+b;return d(a,c,g)};var q=function(a,b){var c=a.url+a.routes.audio;b&&(c+="/ogg");return d(a,c)};var k=function(a,b){return 0<=b&&b<a.numberOfImages?a.imageValues[b]:""};var h=function(){return void 0!==window.devicePixelRatio&&1<window.devicePixelRatio};var u=function(){var a=!1;try{var b=document.createElement("audio");b.canPlayType&&(a=!0)}catch(r){}return a};return function(b){var d=
{refresh:function(){return a.call(this,b)},isLoading:function(){return b.isLoading},hasLoaded:function(){return b.hasLoaded},numberOfImages:function(){return b.imageValues.length},imageName:function(){return b.imageName},imageValue:function(a){return k.call(this,b,a)},imageUrl:function(a){return c.call(this,b,a)},audioUrl:function(a){return q.call(this,b,a)},imageFieldName:function(){return b.imageFieldName},audioFieldName:function(){return b.audioFieldName},namespace:function(){return b.namespace},
namespaceFieldName:function(){return b.namespaceFieldName},isRetina:h,supportsAudio:u};b.autoRefresh&&d.refresh();return d}});l("visualcaptcha/xhr-request",[],function(){var d=window.XMLHttpRequest;return function(a,b){var c=new d;c.open("GET",a,!0);c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var a=JSON.parse(c.responseText);b(a)}};c.send()}});l("visualcaptcha/config",["visualcaptcha/xhr-request"],function(d){return function(a){var b=window.location.href.split("/");b[b.length-
1]="";var c={request:d,url:b.join("/").slice(0,-1),namespace:"",namespaceFieldName:"namespace",routes:{start:"/start",image:"/image",audio:"/audio"},isLoading:!1,hasLoaded:!1,autoRefresh:!0,numberOfImages:6,randomNonce:"",randomParam:"r",audioFieldName:"",imageFieldName:"",imageName:"",imageValues:[],callbacks:{},_loading:function(){},_loaded:function(){},applyRandomNonce:function(){return c.randomNonce=Math.random().toString(36).substring(2)}};a.request&&(c.request=a.request);a.url&&(c.url=a.url);
a.namespace&&(c.namespace=a.namespace);a.namespaceFieldName&&(c.namespaceFieldName=a.namespaceFieldName);"undefined"!==typeof a.autoRefresh&&(c.autoRefresh=a.autoRefresh);a.numberOfImages&&(c.numberOfImages=a.numberOfImages);a.routes&&(a.routes.start&&(c.routes.start=a.routes.start),a.routes.image&&(c.routes.image=a.routes.image),a.routes.audio&&(c.routes.audio=a.routes.audio));a.randomParam&&(c.randomParam=a.randomParam);a.callbacks&&(a.callbacks.loading&&(c.callbacks.loading=a.callbacks.loading),
a.callbacks.loaded&&(c.callbacks.loaded=a.callbacks.loaded));a._loading&&(c._loading=a._loading);a._loaded&&(c._loaded=a._loaded);return c}});l("visualcaptcha",["require","visualcaptcha/core","visualcaptcha/config"],function(d){var a=d("visualcaptcha/core"),b=d("visualcaptcha/config");return function(c){c=c||{};return a(b(c))}});l("visualcaptcha/deep-extend",[],function(){var d;return d=function(a,b){a=a||{};for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},d(a[c],b[c])):
a[c]=b[c];return a}});l("visualcaptcha/helpers",[],function(){var d=function(a,b){return b?a[0]:Array.prototype.slice.call(a)};var a=function(a,b){b=new RegExp("(\\s|^)"+b+"(\\s|$)");return a.className&&b.test(a.className)};var b=function(c,d){if(Array.isArray(c))for(var k=0;k<c.length;k++)b(c[k],d);else a(c,d)||(c.className=0<c.className.length?c.className+(" "+d):d)};var c=function(a,b){if(Array.isArray(a))for(var d=0;d<a.length;d++)c(a[d],b);else b=new RegExp("(\\s|^)"+b+"(\\s|$)"),a.className=
a.className.replace(b," ").replace(/(^\s*)|(\s*$)/g,"")};var q=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)q(a[c],b);else a.addEventListener?a.addEventListener("click",b,!1):a.attachEvent("onclick",b)};return{findByClass:function(a,b,c){a=a.getElementsByClassName(b);return d(a,c)},findByTag:function(a,b,c){a=a.getElementsByTagName(b);return d(a,c)},hasClass:a,addClass:b,removeClass:c,bindClick:q}});l("visualcaptcha/templates",[],function(){var d=function(a,b){for(var c in b)a=a.replace(new RegExp("{"+
c+"}","g"),b[c]);return a};return{buttons:function(a,b,c,q){var k=d(q.button,{class:"accessibility",classTitle:"{accessibilityTitle}",classAlt:"{accessibilityAlt}"});var h=d(q.button,{class:"refresh",classTitle:"{refreshTitle}",classAlt:"{refreshAlt}"});q=d(q.buttonGroup,{btnRefresh:h,btnAccessibility:a.supportsAudio()?k:""});a={path:c||"",refreshTitle:b.refreshTitle,refreshAlt:b.refreshAlt,accessibilityTitle:b.accessibilityTitle,accessibilityAlt:b.accessibilityAlt,retinaExtra:a.isRetina()?"@2x":
""};return d(q,a)},accessibility:function(a,b){if(!a.supportsAudio())return"";a={accessibilityDescription:b.accessibilityDescription,audioURL:a.audioUrl(),audioFieldName:a.audioFieldName()};return d('<div class="visualCaptcha-accessibility-wrapper visualCaptcha-hide"><div class="accessibility-description">{accessibilityDescription}</div><audio preload="preload"><source src="{audioURL}" type="audio/ogg" /><source src="{audioURL}" type="audio/mpeg" /></audio></div>',a)},images:function(a,b){for(var c=
"",q,k,h=0,l=a.numberOfImages();h<l;h++)q='<div class="img"><a href="javascript:;"><img src="{imageUrl}" id="visualCaptcha-img-{i}" data-index="{i}" alt="" title="" /></a></div>',k={imageUrl:a.imageUrl(h),i:h},c+=d(q,k);q='<p class="visualCaptcha-explanation">{explanation}</p><div class="visualCaptcha-possibilities">{images}</div>';k={imageFieldName:a.imageFieldName(),explanation:b.explanation.replace(/ANSWER/,a.imageName()),images:c};return d(q,k)},audioInput:function(a){a={audioFieldName:a.audioFieldName()};
return d('<input class="form-control audioField" type="text" name="{audioFieldName}" value="" autocomplete="off" />',a)},imageInput:function(a,b){a={imageFieldName:a.imageFieldName(),value:a.imageValue(b)};return d('<input class="form-control imageField" type="hidden" name="{imageFieldName}" value="{value}" readonly="readonly" />',a)},namespaceInput:function(a){var b=a.namespace();if(!b||0===b.length)return"";a={fieldName:a.namespaceFieldName(),value:b};return d('<input type="hidden" name="{fieldName}" value="{value}" />',
a)}}});l("visualcaptcha/language",[],function(){return{accessibilityAlt:"Sound icon",accessibilityTitle:"Accessibility option: listen to a question and answer it!",accessibilityDescription:"Type below the <strong>answer</strong> to what you hear. Numbers or words:",explanation:"Click or touch the <strong>ANSWER</strong>",refreshAlt:"Refresh/reload icon",refreshTitle:"Refresh/reload: get new images and accessibility option!"}});l("visualcaptcha.vanilla",["visualcaptcha","visualcaptcha/deep-extend",
"visualcaptcha/helpers","visualcaptcha/templates","visualcaptcha/language"],function(d,a,b,c,l){var k=function(){};var h=function(a,d){var g=a.config;g=c.namespaceInput(d)+c.accessibility(d,g.language)+c.images(d,g.language)+c.buttons(d,g.language,g.imgPath,g.templates);a.innerHTML=g;g=b.findByClass(a,"visualCaptcha-accessibility-button",!0);b.bindClick(g,q.bind(null,a,d));g=b.findByClass(a,"visualCaptcha-refresh-button",!0);b.bindClick(g,n.bind(null,a,d));g=b.findByClass(a,"visualCaptcha-possibilities",
!0);b.bindClick(b.findByClass(g,"img"),e.bind(null,a,d))};var q=function(a,d){var g=b.findByClass(a,"visualCaptcha-accessibility-wrapper",!0),e=b.findByClass(a,"visualCaptcha-possibilities",!0),t=b.findByClass(a,"visualCaptcha-explanation",!0);a=b.findByTag(g,"audio",!0);b.hasClass(g,"visualCaptcha-hide")?(b.addClass(e,"visualCaptcha-hide"),b.addClass(t,"visualCaptcha-hide"),e=b.findByClass(e,"img"),b.removeClass(e,"visualCaptcha-selected"),e=b.findByTag(t,"input",!0),void 0!==e&&(e.value=""),d=c.audioInput(d),
g.innerHTML=g.innerHTML.replace("<audio",d+"<audio"),b.removeClass(g,"visualCaptcha-hide"),a.load(),a.play()):(a.pause(),b.addClass(g,"visualCaptcha-hide"),d=b.findByTag(g,"input",!0),g.removeChild(d),b.removeClass(t,"visualCaptcha-hide"),b.removeClass(e,"visualCaptcha-hide"))};var e=function(a,d,e){e=e.currentTarget;var g=b.findByClass(a,"visualCaptcha-possibilities",!0);a=b.findByClass(a,"visualCaptcha-explanation",!0);var p;if(p=b.findByTag(a,"input",!0))a.removeChild(p),g=b.findByClass(g,"img"),
b.removeClass(g,"visualCaptcha-selected");b.addClass(e,"visualCaptcha-selected");e=b.findByTag(e,"img",!0);e=parseInt(e.getAttribute("data-index"),10);d=c.imageInput(d,e);a.innerHTML+=d};var n=function(a,b){b.refresh()};var r=function(a){var c=b.findByClass(a,"imageField",!0)||{};a=b.findByClass(a,"audioField",!0)||{};var d=!(!c.value&&!a.value);return d?{valid:d,name:c.value?c.name:a.name,value:c.value?c.value:a.value}:{valid:d}};return function(c,e){e=a({imgPath:"/",language:l,captcha:{},templates:{button:'<div class="visualCaptcha-{class}-button"><a href="javascript:;"><img src="{path}{class}{retinaExtra}.png" title="{classTitle}" alt="{classAlt}"></a></div>',
buttonGroup:'<div class="visualCaptcha-button-group">{btnRefresh}{btnAccessibility}</div>'}},e);c="string"===typeof c?document.getElementById(c):c;c.config=e;b.addClass(c,"visualCaptcha");var g=a(e.captcha,{_loading:k.bind(null,c),_loaded:h.bind(null,c)});"undefined"!==typeof c.getAttribute("data-namespace")&&(g.namespace=c.getAttribute("data-namespace"));g=d(g);g.getCaptchaData=r.bind(null,c);"function"===typeof e.init&&e.init.call(null,g);return g}});return v("visualcaptcha.vanilla")});
